<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ë‹¨ì–´ ê²€ìƒ‰</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; padding: 40px; max-width: 900px; margin: 0 auto; line-height: 1.6; }
        
        /* Control Panel Styles */
        .controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        .control-group {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        .control-label {
            font-weight: bold;
            margin-right: 15px;
            min-width: 80px;
            font-size: 0.9em;
            color: #495057;
        }
        .radio-label {
            margin-right: 20px;
            cursor: pointer;
            font-size: 0.95em;
        }
        input[type="radio"] {
            margin-right: 5px;
        }

        .status-box { padding: 10px; background: #e2e3e5; border-radius: 4px; font-size: 0.9em; margin-bottom: 20px;}
        input[type="text"] { padding: 8px; width: 60%; }
        button { padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #0056b3; }
        
        .success { color: green; font-weight: bold; }
        .failure { color: red; font-weight: bold; }

        /* Help Box Styles (Modified for Toggle) */
        .help-box {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 10px 15px; /* Reduced padding slightly */
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .help-header h3 {
            margin: 0;
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .help-content {
            margin-top: 10px;
            /* Default display state managed by JS or inline style */
        }
        .help-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .help-box li {
            margin-bottom: 5px;
        }
        .help-box code {
            background-color: rgba(255,255,255,0.5);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
            font-weight: bold;
        }

        /* Copy Button Style */
        #copyAllBtn {
            background-color: #28a745;
            margin-left: 10px;
            display: none; /* Hidden by default */
            font-size: 0.9em;
        }
        #copyAllBtn:hover { background-color: #218838; }

        /* --- VIRTUAL SCROLLER STYLES --- */
        #scroller-container {
            border: 1px solid #ddd;
            height: 500px; /* Fixed height is required for virtual scrolling */
            overflow-y: auto; /* Allow scrolling */
            position: relative;
            margin-top: 20px;
            background: #fff;
            display: none; /* Hidden until results exist */
        }

        #scroller-content {
            list-style: none;
            padding: 0;
            margin: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
        }

        .word-item {
            height: 35px; 
            line-height: 35px;
            padding: 0 15px;
            border-bottom: 1px solid #f0f0f0;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: default; /* Changed from pointer */
        }
        
        .word-item:hover {
            background-color: #f8f9fa;
        }

        #phantom-spacer {
            width: 1px;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* --- UPDATE LOG STYLES --- */
        .update-log {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #000000;
            font-size: 0.9em;
        }
        .update-log h3 {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
        }
        .update-log ul {
            list-style-type: disc;
            padding-left: 20px;
            line-height: 1.6;
        }
        .update-log li {
            margin-bottom: 8px;
        }
        .log-date {
            font-weight: bold;
            color: #333;
            margin-right: 8px;
            font-family: monospace;
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>í•œêµ­ì–´ ë‹¨ì–´ ê²€ìƒ‰</h1>
    <p>ì•„ë˜ì—ì„œ ì‚¬ì „ì„ ì„ íƒí•˜ê³  ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>

    <!-- Dictionary Selection Controls -->
    <div class="controls">
        <div class="control-group">
            <span class="control-label">ì‚¬ì „ ì¢…ë¥˜:</span>
            <label class="radio-label"><input type="radio" name="dictType" value="standard_" checked> í‘œì¤€êµ­ì–´ëŒ€ì‚¬ì „</label>
            <label class="radio-label"><input type="radio" name="dictType" value="basic_"> í•œêµ­ì–´ê¸°ì´ˆì‚¬ì „</label>
        </div>
        <div class="control-group">
            <span class="control-label">ë‹¨ì–´ ë²”ìœ„:</span>
            <label class="radio-label"><input type="radio" name="wordScope" value="all_words" checked> ëª¨ë“  ë‹¨ì–´</label>
            <label class="radio-label"><input type="radio" name="wordScope" value="immutables"> ë¶ˆë³€ì–´ë§Œ (ëª…ì‚¬ ë“±)</label>
        </div>
    </div>

    <div id="status" class="status-box">â³ ì„œë²„ ì—°ê²° ì¤‘...</div>

    <!-- Help Box (Collapsible) -->
    <div class="help-box">
        <div class="help-header" id="helpHeader">
            <h3>ê²€ìƒ‰ ë„ì›€ë§</h3>
            <span id="helpToggleIcon">â–¼</span>
        </div>
        <div class="help-content" id="helpContent">
            <ul>
                <li><code>?</code> : ì•„ë¬´ í•œ ê¸€ì ë¬¸ìì—´ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. (ì˜ˆ: <code>?ê³¼</code> â†’ ì‚¬ê³¼, ì„±ê³¼ ë“±)</li>
                <li><code>*</code> : ì•„ë¬´ ë¬¸ìì—´(0ê¸€ì í¬í•¨)ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. (ì˜ˆ: <code>*ìƒ</code> â†’ ìƒ, ë°¥ìƒ, ì„¤ìƒê°€ìƒ ë“±)</li>
                <li>ì—¬ëŸ¬ ì¡°ê±´ì„ ì„ì–´ì„œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: <code>ì¥??*</code> â†’ ì¥ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 3ê¸€ì ì´ìƒì˜ ë‹¨ì–´)</li>
            </ul>
        </div>
    </div>

    <form id="searchForm">
        <input type="text" id="wordInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
        <button type="submit">ê²€ìƒ‰</button>
    </form>

    <div id="result-area">
        <div class="result-header">
            <p id="result-message"></p>
            <button id="copyAllBtn">ğŸ“‹ ëª¨ë‘ ë³µì‚¬</button>
        </div>
        
        <div id="scroller-container">
            <div id="phantom-spacer"></div>
            <ul id="scroller-content"></ul>
        </div>
    </div>

    <!-- UPDATE LOG SECTION (Empty for user) -->
    <div class="update-log">
        <h2>ì—…ë°ì´íŠ¸ ë¡œê·¸</h2>
        <ul>
            <li>
                <span class="log-date">2025-12-06</span>
                ì™€ì¼ë“œ ì¹´ë“œ(*), ê²€ìƒ‰ ë„ì›€ë§ ì¶”ê°€
            </li>
            <li>
                <span class="log-date">2025-12-04</span>
                ì‚¬ì´íŠ¸ ìµœì´ˆ ê³µê°œ, ì™€ì¼ë“œ ì¹´ë“œ(?) ì¶”ê°€
            </li>
        </ul>
    </div>

    <script>
        // Data
        let downloadedWords = [];
        let currentMatches = [];
        
        // Virtual Scroll Configuration
        const ITEM_HEIGHT = 35;
        const CONTAINER_HEIGHT = 500;
        const VISIBLE_COUNT = Math.ceil(CONTAINER_HEIGHT / ITEM_HEIGHT) + 10;

        // UI Elements
        const statusDiv = document.getElementById('status');
        const container = document.getElementById('scroller-container');
        const content = document.getElementById('scroller-content');
        const spacer = document.getElementById('phantom-spacer');
        const messageP = document.getElementById('result-message');
        const copyBtn = document.getElementById('copyAllBtn');

        // Help Box Toggle Logic
        const helpHeader = document.getElementById('helpHeader');
        const helpContent = document.getElementById('helpContent');
        const helpToggleIcon = document.getElementById('helpToggleIcon');

        helpHeader.addEventListener('click', () => {
            if (helpContent.style.display === 'none') {
                helpContent.style.display = 'block';
                helpToggleIcon.textContent = 'â–¼';
            } else {
                helpContent.style.display = 'none';
                helpToggleIcon.textContent = 'â–²'; // Show up arrow when collapsed
            }
        });

        // --- DICTIONARY LOADING LOGIC ---
        function loadDictionary() {
            // Get selected values
            const dictType = document.querySelector('input[name="dictType"]:checked').value;
            const wordScope = document.querySelector('input[name="wordScope"]:checked').value;
            
            // Construct filename: words/standard_all_words.txt
            const filename = `words/${dictType}${wordScope}.txt`;

            // Update UI status
            statusDiv.innerText = `â³ ì‚¬ì „ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘... (${filename})`;
            statusDiv.style.background = "#e2e3e5";

            // Clear existing data/results
            downloadedWords = [];
            currentMatches = [];
            container.style.display = 'none';
            copyBtn.style.display = 'none';
            messageP.innerText = '';

            fetch(filename)
                .then(res => {
                    if (!res.ok) throw new Error("File not found");
                    return res.text();
                })
                .then(text => {
                    downloadedWords = text.split('\n').map(w => w.trim());
                    statusDiv.innerText = `ì‚¬ì „ ì¤€ë¹„ ì™„ë£Œ! (${downloadedWords.length.toLocaleString()} ë‹¨ì–´)`;
                    statusDiv.style.background = "#d4edda";
                })
                .catch(err => {
                    statusDiv.innerText = `âŒ ì˜¤ë¥˜: ${filename} íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                    statusDiv.style.background = "#f8d7da";
                });
        }

        // Add Event Listeners for Controls
        const radios = document.querySelectorAll('input[name="dictType"], input[name="wordScope"]');
        radios.forEach(radio => {
            radio.addEventListener('change', loadDictionary);
        });

        // Initial Load
        loadDictionary();

        // --- SEARCH & COPY LOGIC ---
        
        copyBtn.addEventListener('click', () => {
            if (currentMatches.length === 0) return;
            const allText = currentMatches.join('\n');
            const textArea = document.createElement("textarea");
            textArea.value = allText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert(`${currentMatches.length.toLocaleString()}ê°œì˜ ë‹¨ì–´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        });

        function renderVirtualScroll() {
            const scrollTop = container.scrollTop;
            const startIndex = Math.floor(scrollTop / ITEM_HEIGHT);
            const endIndex = Math.min(startIndex + VISIBLE_COUNT, currentMatches.length);

            const fragment = document.createDocumentFragment();
            for (let i = startIndex; i < endIndex; i++) {
                const li = document.createElement('li');
                li.className = 'word-item';
                li.textContent = currentMatches[i];
                // Removed onclick event (single word copy)
                fragment.appendChild(li);
            }

            content.innerHTML = '';
            content.appendChild(fragment);
            content.style.transform = `translateY(${startIndex * ITEM_HEIGHT}px)`;
        }

        container.addEventListener('scroll', () => {
            window.requestAnimationFrame(renderVirtualScroll);
        });

        document.getElementById('searchForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('wordInput').value.trim();
            copyBtn.style.display = 'none';

            if (!input) return;

            // Check if dictionary is loaded
            if (downloadedWords.length === 0) {
                messageP.innerHTML = `<span class="failure">ì˜¤ë¥˜.</span> ì‚¬ì „ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
                return;
            }

            try {
                // Modified Logic to support * wildcard
                const regexPattern = input.split('').map(char => {
                    if (char === '?') return '.';   // ? matches exactly one char
                    if (char === '*') return '.*';  // * matches 0 or more of any char
                    return char.replace(/[.*+^${}()|[\]\\]/g, '\\$&'); // Escape others
                }).join('');
                
                const regex = new RegExp(`^${regexPattern}$`);

                currentMatches = downloadedWords.filter(w => regex.test(w));

                if (currentMatches.length > 0) {
                    messageP.innerHTML = `<span class="success">ì„±ê³µ!</span> ${currentMatches.length.toLocaleString()}ê°œì˜ ë‹¨ì–´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
                    
                    container.style.display = 'block';
                    copyBtn.style.display = 'inline-block';
                    
                    spacer.style.height = `${currentMatches.length * ITEM_HEIGHT}px`;
                    container.scrollTop = 0;
                    renderVirtualScroll();
                } else {
                    messageP.innerHTML = `<span class="failure">ì¡°ê±´ì— ë§ëŠ” ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>`;
                    container.style.display = 'none';
                }

            } catch (error) {
                console.error(error);
                messageP.innerHTML = `<span class="failure">ì˜¤ë¥˜.</span> íŒ¨í„´ í™•ì¸ í•„ìš”.`;
            }
        });
    </script>

</body>
</html>
